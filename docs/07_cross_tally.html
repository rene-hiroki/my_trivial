<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter: 7 Rでクロス集計（janitor） | 日々の雑学</title>
  <meta name="description" content="バットルドォーム！3Dアックションゲーム！" />
  <meta name="generator" content="bookdown 0.21.4 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter: 7 Rでクロス集計（janitor） | 日々の雑学" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="バットルドォーム！3Dアックションゲーム！" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter: 7 Rでクロス集計（janitor） | 日々の雑学" />
  
  <meta name="twitter:description" content="バットルドォーム！3Dアックションゲーム！" />
  

<meta name="author" content="Akiyama Hiroki" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="06_NBA_cluster.html"/>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/dt-plugin-searchhighlight-1.10.20/source.css" rel="stylesheet" />
<script src="libs/dt-plugin-searchhighlight-1.10.20/jquery.highlight.js"></script>
<script src="libs/dt-plugin-searchhighlight-1.10.20/source.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
My Trivial
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>はじめに</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#環境"><i class="fa fa-check"></i><b>0.1</b> 環境</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01_android_analysis.html"><a href="01_android_analysis.html"><i class="fa fa-check"></i><b>1</b> android分析</a>
<ul>
<li class="chapter" data-level="1.1" data-path="01_android_analysis.html"><a href="01_android_analysis.html#ライブラリの準備"><i class="fa fa-check"></i><b>1.1</b> ライブラリの準備</a></li>
<li class="chapter" data-level="1.2" data-path="01_android_analysis.html"><a href="01_android_analysis.html#activityをダウンロード"><i class="fa fa-check"></i><b>1.2</b> activityをダウンロード</a></li>
<li class="chapter" data-level="1.3" data-path="01_android_analysis.html"><a href="01_android_analysis.html#ここから解析"><i class="fa fa-check"></i><b>1.3</b> ここから解析</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="01_android_analysis.html"><a href="01_android_analysis.html#activityの読み込み"><i class="fa fa-check"></i><b>1.3.1</b> activityの読み込み</a></li>
<li class="chapter" data-level="1.3.2" data-path="01_android_analysis.html"><a href="01_android_analysis.html#読み込んだactivityデータの概要確認"><i class="fa fa-check"></i><b>1.3.2</b> 読み込んだactivityデータの概要確認</a></li>
<li class="chapter" data-level="1.3.3" data-path="01_android_analysis.html"><a href="01_android_analysis.html#timeデータを変換"><i class="fa fa-check"></i><b>1.3.3</b> timeデータを変換</a></li>
<li class="chapter" data-level="1.3.4" data-path="01_android_analysis.html"><a href="01_android_analysis.html#年月ごとのデータ数の集計"><i class="fa fa-check"></i><b>1.3.4</b> 年月ごとのデータ数の集計</a></li>
<li class="chapter" data-level="1.3.5" data-path="01_android_analysis.html"><a href="01_android_analysis.html#データの準備"><i class="fa fa-check"></i><b>1.3.5</b> データの準備</a></li>
<li class="chapter" data-level="1.3.6" data-path="01_android_analysis.html"><a href="01_android_analysis.html#アプリの使用回数2019-2020"><i class="fa fa-check"></i><b>1.3.6</b> アプリの使用回数（2019-2020）</a></li>
<li class="chapter" data-level="1.3.7" data-path="01_android_analysis.html"><a href="01_android_analysis.html#アプリの使用回数すべての年"><i class="fa fa-check"></i><b>1.3.7</b> アプリの使用回数（すべての年）</a></li>
<li class="chapter" data-level="1.3.8" data-path="01_android_analysis.html"><a href="01_android_analysis.html#比較2019-vs-2020"><i class="fa fa-check"></i><b>1.3.8</b> 比較（2019 vs 2020）</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02_standard_input.html"><a href="02_standard_input.html"><i class="fa fa-check"></i><b>2</b> 標準入力</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02_standard_input.html"><a href="02_standard_input.html#readlines"><i class="fa fa-check"></i><b>2.1</b> readLines</a></li>
<li class="chapter" data-level="2.2" data-path="02_standard_input.html"><a href="02_standard_input.html#スクリプトで計算処理"><i class="fa fa-check"></i><b>2.2</b> スクリプトで計算処理</a></li>
<li class="chapter" data-level="2.3" data-path="02_standard_input.html"><a href="02_standard_input.html#テキストファイルを読ませる"><i class="fa fa-check"></i><b>2.3</b> テキストファイルを読ませる</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03_ido_keido.html"><a href="03_ido_keido.html"><i class="fa fa-check"></i><b>3</b> 緯度経度からちょっとインタラクティブな地図作成</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03_ido_keido.html"><a href="03_ido_keido.html#ライブラリ読み込み"><i class="fa fa-check"></i><b>3.1</b> ライブラリ読み込み</a></li>
<li class="chapter" data-level="3.2" data-path="03_ido_keido.html"><a href="03_ido_keido.html#データ準備"><i class="fa fa-check"></i><b>3.2</b> データ準備</a></li>
<li class="chapter" data-level="3.3" data-path="03_ido_keido.html"><a href="03_ido_keido.html#ポップアップの文字作成"><i class="fa fa-check"></i><b>3.3</b> ポップアップの文字作成</a></li>
<li class="chapter" data-level="3.4" data-path="03_ido_keido.html"><a href="03_ido_keido.html#マーカーリスト"><i class="fa fa-check"></i><b>3.4</b> マーカーリスト</a></li>
<li class="chapter" data-level="3.5" data-path="03_ido_keido.html"><a href="03_ido_keido.html#地図にプロットする"><i class="fa fa-check"></i><b>3.5</b> 地図にプロットする</a></li>
<li class="chapter" data-level="3.6" data-path="03_ido_keido.html"><a href="03_ido_keido.html#データ一覧"><i class="fa fa-check"></i><b>3.6</b> データ一覧</a></li>
<li class="chapter" data-level="3.7" data-path="03_ido_keido.html"><a href="03_ido_keido.html#マーカーリスト-1"><i class="fa fa-check"></i><b>3.7</b> マーカーリスト</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html"><i class="fa fa-check"></i><b>4</b> pandocでmarkdownから日本語pdf出力 in vscode</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#目次"><i class="fa fa-check"></i><b>4.1</b> 目次</a></li>
<li class="chapter" data-level="4.2" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#vspd_start"><i class="fa fa-check"></i><b>4.2</b> はじめに</a></li>
<li class="chapter" data-level="4.3" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#vspd_purpose"><i class="fa fa-check"></i><b>4.3</b> 目的</a></li>
<li class="chapter" data-level="4.4" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#vspd_method"><i class="fa fa-check"></i><b>4.4</b> 方法</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_1"><i class="fa fa-check"></i><b>4.4.1</b> Rstudioのpandocにpathを通す</a></li>
<li class="chapter" data-level="4.4.2" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_2"><i class="fa fa-check"></i><b>4.4.2</b> vscodeの拡張をいろいろ追加していく</a></li>
<li class="chapter" data-level="4.4.3" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_3"><i class="fa fa-check"></i><b>4.4.3</b> 簡易版TeX環境を作る</a></li>
<li class="chapter" data-level="4.4.4" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_4"><i class="fa fa-check"></i><b>4.4.4</b> ipaexフォントをインストールする</a></li>
<li class="chapter" data-level="4.4.5" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_5"><i class="fa fa-check"></i><b>4.4.5</b> YAML front matter</a></li>
<li class="chapter" data-level="4.4.6" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#tejun_6"><i class="fa fa-check"></i><b>4.4.6</b> 出力のコマンド</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#vspd_sample"><i class="fa fa-check"></i><b>4.5</b> サンプルmd</a></li>
<li class="chapter" data-level="4.6" data-path="04_md-to-pdf.html"><a href="04_md-to-pdf.html#追記"><i class="fa fa-check"></i><b>4.6</b> 追記</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05_mystery.html"><a href="05_mystery.html"><i class="fa fa-check"></i><b>5</b> slackの謎</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05_mystery.html"><a href="05_mystery.html#投稿数激増バトルドォーム"><i class="fa fa-check"></i><b>5.1</b> 投稿数激増！バトルドォーム！</a></li>
<li class="chapter" data-level="5.2" data-path="05_mystery.html"><a href="05_mystery.html#バトルドォームの差分"><i class="fa fa-check"></i><b>5.2</b> バトルドォーム！の差分</a></li>
<li class="chapter" data-level="5.3" data-path="05_mystery.html"><a href="05_mystery.html#超エキサイティン"><i class="fa fa-check"></i><b>5.3</b> 超！エキサイティン！！</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html"><i class="fa fa-check"></i><b>6</b> NBAのスタッツデータでクラスタリング</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#前処理"><i class="fa fa-check"></i><b>6.1</b> 前処理</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#ライブラリとデータ読み込み"><i class="fa fa-check"></i><b>6.1.1</b> ライブラリとデータ読み込み</a></li>
<li class="chapter" data-level="6.1.2" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#データの整理"><i class="fa fa-check"></i><b>6.1.2</b> データの整理</a></li>
<li class="chapter" data-level="6.1.3" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#各ポジションの選手数"><i class="fa fa-check"></i><b>6.1.3</b> 各ポジションの選手数</a></li>
<li class="chapter" data-level="6.1.4" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#つのポジションにする"><i class="fa fa-check"></i><b>6.1.4</b> ５つのポジションにする</a></li>
<li class="chapter" data-level="6.1.5" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#欠損の可視化"><i class="fa fa-check"></i><b>6.1.5</b> 欠損の可視化</a></li>
<li class="chapter" data-level="6.1.6" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#欠損の除去"><i class="fa fa-check"></i><b>6.1.6</b> 欠損の除去</a></li>
<li class="chapter" data-level="6.1.7" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#チームの略称を整理する"><i class="fa fa-check"></i><b>6.1.7</b> チームの略称を整理する</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#可視化"><i class="fa fa-check"></i><b>6.2</b> 可視化</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#クラスタリングに使用するデータ"><i class="fa fa-check"></i><b>6.2.1</b> クラスタリングに使用するデータ</a></li>
<li class="chapter" data-level="6.2.2" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#pcaしてみる"><i class="fa fa-check"></i><b>6.2.2</b> PCAしてみる</a></li>
<li class="chapter" data-level="6.2.3" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#pcaの２軸でポジション別プロット"><i class="fa fa-check"></i><b>6.2.3</b> PCAの２軸でポジション別プロット</a></li>
<li class="chapter" data-level="6.2.4" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#チーム別ポジション別でpca２軸"><i class="fa fa-check"></i><b>6.2.4</b> チーム別ポジション別でPCA２軸</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#kmeansでクラスタリング"><i class="fa fa-check"></i><b>6.3</b> kmeansでクラスタリング</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#エルボー法とシルエット法でクラスタ数チェック"><i class="fa fa-check"></i><b>6.3.1</b> エルボー法とシルエット法でクラスタ数チェック</a></li>
<li class="chapter" data-level="6.3.2" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#kmeans２と３と５"><i class="fa fa-check"></i><b>6.3.2</b> kmeans２と３と５</a></li>
<li class="chapter" data-level="6.3.3" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#結果をpcaの2軸で可視化してみる"><i class="fa fa-check"></i><b>6.3.3</b> 結果をPCAの2軸で可視化してみる。</a></li>
<li class="chapter" data-level="6.3.4" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#チーム別kmeansプロット"><i class="fa fa-check"></i><b>6.3.4</b> チーム別kmeansプロット</a></li>
<li class="chapter" data-level="6.3.5" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#選手名つき"><i class="fa fa-check"></i><b>6.3.5</b> 選手名つき</a></li>
<li class="chapter" data-level="6.3.6" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#スタメンかどうかでわける"><i class="fa fa-check"></i><b>6.3.6</b> スタメンかどうかでわける</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="06_NBA_cluster.html"><a href="06_NBA_cluster.html#雑感"><i class="fa fa-check"></i><b>6.4</b> 雑感</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07_cross_tally.html"><a href="07_cross_tally.html"><i class="fa fa-check"></i><b>7</b> Rでクロス集計（janitor）</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07_cross_tally.html"><a href="07_cross_tally.html#janitorパッケージ"><i class="fa fa-check"></i><b>7.1</b> janitorパッケージ</a></li>
<li class="chapter" data-level="7.2" data-path="07_cross_tally.html"><a href="07_cross_tally.html#データの準備-1"><i class="fa fa-check"></i><b>7.2</b> データの準備</a></li>
<li class="chapter" data-level="7.3" data-path="07_cross_tally.html"><a href="07_cross_tally.html#cutカラムの度数表"><i class="fa fa-check"></i><b>7.3</b> cutカラムの度数表</a></li>
<li class="chapter" data-level="7.4" data-path="07_cross_tally.html"><a href="07_cross_tally.html#欠損がある場合"><i class="fa fa-check"></i><b>7.4</b> 欠損がある場合</a></li>
<li class="chapter" data-level="7.5" data-path="07_cross_tally.html"><a href="07_cross_tally.html#度数表のtotal値"><i class="fa fa-check"></i><b>7.5</b> 度数表のtotal値</a></li>
<li class="chapter" data-level="7.6" data-path="07_cross_tally.html"><a href="07_cross_tally.html#度数表の表記"><i class="fa fa-check"></i><b>7.6</b> 度数表の％表記</a></li>
<li class="chapter" data-level="7.7" data-path="07_cross_tally.html"><a href="07_cross_tally.html#クロス集計"><i class="fa fa-check"></i><b>7.7</b> クロス集計</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="07_cross_tally.html"><a href="07_cross_tally.html#通常のやり方"><i class="fa fa-check"></i><b>7.7.1</b> 通常のやり方</a></li>
<li class="chapter" data-level="7.7.2" data-path="07_cross_tally.html"><a href="07_cross_tally.html#janitorのやり方"><i class="fa fa-check"></i><b>7.7.2</b> janitorのやり方</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="07_cross_tally.html"><a href="07_cross_tally.html#クロス集計の装飾"><i class="fa fa-check"></i><b>7.8</b> クロス集計の装飾</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="07_cross_tally.html"><a href="07_cross_tally.html#totalと"><i class="fa fa-check"></i><b>7.8.1</b> totalと％</a></li>
<li class="chapter" data-level="7.8.2" data-path="07_cross_tally.html"><a href="07_cross_tally.html#集計値の名前を変更"><i class="fa fa-check"></i><b>7.8.2</b> 集計値の名前を変更</a></li>
<li class="chapter" data-level="7.8.3" data-path="07_cross_tally.html"><a href="07_cross_tally.html#度数表と割合を同時に表示"><i class="fa fa-check"></i><b>7.8.3</b> 度数表と割合を同時に表示</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="07_cross_tally.html"><a href="07_cross_tally.html#関数化"><i class="fa fa-check"></i><b>7.9</b> 関数化</a></li>
<li class="chapter" data-level="7.10" data-path="07_cross_tally.html"><a href="07_cross_tally.html#可視化-1"><i class="fa fa-check"></i><b>7.10</b> 可視化</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="07_cross_tally.html"><a href="07_cross_tally.html#モザイクプロット"><i class="fa fa-check"></i><b>7.10.1</b> モザイクプロット</a></li>
<li class="chapter" data-level="7.10.2" data-path="07_cross_tally.html"><a href="07_cross_tally.html#通常のテーブル"><i class="fa fa-check"></i><b>7.10.2</b> 通常のテーブル</a></li>
<li class="chapter" data-level="7.10.3" data-path="07_cross_tally.html"><a href="07_cross_tally.html#装飾を加えたテーブル"><i class="fa fa-check"></i><b>7.10.3</b> 装飾を加えたテーブル</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">日々の雑学</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rでクロス集計janitor" class="section level1" number="7">
<h1><span class="header-section-number">Chapter: 7</span> Rでクロス集計（janitor）</h1>
<p>janitorパッケージを使うと、Rでのクロス集計がかなり捗る。</p>
<p>クロス集計をする前に、まずは1つのデータでの度数表の作成や、その他便利な関数を紹介する。</p>
<p>その後に、クロス集計を行う。</p>
<p>最後に、クロス集計で出来たデータでの可視化も行ってみる。</p>
<div id="janitorパッケージ" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> janitorパッケージ</h2>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="07_cross_tally.html#cb91-1"></a>knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">comment =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb91-2"><a href="07_cross_tally.html#cb91-2"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;janitor&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;janitor&quot;</span>)</span>
<span id="cb91-3"><a href="07_cross_tally.html#cb91-3"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;naniar&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;naniar&quot;</span>)</span>
<span id="cb91-4"><a href="07_cross_tally.html#cb91-4"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;DT&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;DT&quot;</span>)</span>
<span id="cb91-5"><a href="07_cross_tally.html#cb91-5"></a><span class="kw">library</span>(janitor)</span>
<span id="cb91-6"><a href="07_cross_tally.html#cb91-6"></a><span class="kw">library</span>(naniar)</span>
<span id="cb91-7"><a href="07_cross_tally.html#cb91-7"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="データの準備-1" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> データの準備</h2>
<p>Rに標準搭載されているdiamondsデータを使う。</p>
<p>今回はクロス集計をおこなうため、cut と colorのカラムを主に扱う。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="07_cross_tally.html#cb92-1"></a>data &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() </span>
<span id="cb92-2"><a href="07_cross_tally.html#cb92-2"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>Rows: 53,940
Columns: 10
$ carat   &lt;dbl&gt; 0.23, 0.21, 0.23, 0.29, 0.31, 0.24, 0.24, 0.26, 0.22, 0.23, 0.30, 0.23, 0.22, 0.31, 0.20, 0.32, 0.30, 0.30, 0.30, 0.30, 0.30, 0.23, 0.23, 0.31, 0.31, 0.23, 0.24...
$ cut     &lt;ord&gt; Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Very Good, Fair, Very Good, Good, Ideal, Premium, Ideal, Premium, Premium, Ideal, Good, Good, Very Go...
$ color   &lt;ord&gt; E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I, E, H, J, J, G, I, J, D, F, F, F, E, E, D, F, E, H, D, I, I, J, D, D, H, F, H, H, E, H, F, G, I, E...
$ clarity &lt;ord&gt; SI2, SI1, VS1, VS2, SI2, VVS2, VVS1, SI1, VS2, VS1, SI1, VS1, SI1, SI2, SI2, I1, SI2, SI1, SI1, SI1, SI2, VS2, VS1, SI1, SI1, VVS2, VS1, VS2, VS2, VS1, VS1, VS1...
$ depth   &lt;dbl&gt; 61.5, 59.8, 56.9, 62.4, 63.3, 62.8, 62.3, 61.9, 65.1, 59.4, 64.0, 62.8, 60.4, 62.2, 60.2, 60.9, 62.0, 63.4, 63.8, 62.7, 63.3, 63.8, 61.0, 59.4, 58.1, 60.4, 62.5...
$ table   &lt;dbl&gt; 55, 61, 65, 58, 58, 57, 57, 55, 61, 61, 55, 56, 61, 54, 62, 58, 54, 54, 56, 59, 56, 55, 57, 62, 62, 58, 57, 57, 61, 57, 57, 57, 59, 58, 58, 59, 59, 54, 59, 55, ...
$ price   &lt;int&gt; 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 342, 344, 345, 345, 348, 351, 351, 351, 351, 352, 353, 353, 353, 354, 355, 357, 357, 357, 402, 402, ...
$ x       &lt;dbl&gt; 3.95, 3.89, 4.05, 4.20, 4.34, 3.94, 3.95, 4.07, 3.87, 4.00, 4.25, 3.93, 3.88, 4.35, 3.79, 4.38, 4.31, 4.23, 4.23, 4.21, 4.26, 3.85, 3.94, 4.39, 4.44, 3.97, 3.97...
$ y       &lt;dbl&gt; 3.98, 3.84, 4.07, 4.23, 4.35, 3.96, 3.98, 4.11, 3.78, 4.05, 4.28, 3.90, 3.84, 4.37, 3.75, 4.42, 4.34, 4.29, 4.26, 4.27, 4.30, 3.92, 3.96, 4.43, 4.47, 4.01, 3.94...
$ z       &lt;dbl&gt; 2.43, 2.31, 2.31, 2.63, 2.75, 2.48, 2.47, 2.53, 2.49, 2.39, 2.73, 2.46, 2.33, 2.71, 2.27, 2.68, 2.68, 2.70, 2.71, 2.66, 2.71, 2.48, 2.41, 2.62, 2.59, 2.41, 2.47...</code></pre>
<p>先頭100行だけを表示。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="07_cross_tally.html#cb94-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-2"><a href="07_cross_tally.html#cb94-2"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-3"><a href="07_cross_tally.html#cb94-3"></a><span class="st">  </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-91c6cf58e20cd2aa5e61" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-91c6cf58e20cd2aa5e61">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[0.23,0.21,0.23,0.29,0.31,0.24,0.24,0.26,0.22,0.23,0.3,0.23,0.22,0.31,0.2,0.32,0.3,0.3,0.3,0.3,0.3,0.23,0.23,0.31,0.31,0.23,0.24,0.3,0.23,0.23,0.23,0.23,0.23,0.23,0.23,0.23,0.23,0.31,0.26,0.33,0.33,0.33,0.26,0.26,0.32,0.29,0.32,0.32,0.25,0.29,0.24,0.23,0.32,0.22,0.22,0.3,0.3,0.3,0.3,0.3,0.35,0.3,0.3,0.3,0.42,0.28,0.32,0.31,0.31,0.24,0.24,0.3,0.3,0.3,0.3,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.38,0.26,0.24,0.24,0.24,0.24,0.32,0.7,0.86,0.7,0.71,0.78,0.7,0.7,0.96,0.73,0.8],["Ideal","Premium","Good","Premium","Good","Very Good","Very Good","Very Good","Fair","Very Good","Good","Ideal","Premium","Ideal","Premium","Premium","Ideal","Good","Good","Very Good","Good","Very Good","Very Good","Very Good","Very Good","Very Good","Premium","Very Good","Very Good","Very Good","Very Good","Very Good","Very Good","Very Good","Very Good","Good","Good","Good","Very Good","Ideal","Ideal","Ideal","Good","Good","Good","Premium","Very Good","Good","Very Good","Very Good","Very Good","Ideal","Ideal","Premium","Premium","Ideal","Premium","Very Good","Very Good","Good","Ideal","Premium","Ideal","Ideal","Premium","Ideal","Ideal","Very Good","Premium","Premium","Very Good","Very Good","Premium","Premium","Good","Very Good","Very Good","Very Good","Very Good","Very Good","Very Good","Very Good","Ideal","Ideal","Good","Premium","Premium","Premium","Premium","Premium","Ideal","Fair","Ideal","Very Good","Very Good","Good","Good","Fair","Very Good","Premium"],["E","E","E","I","J","J","I","H","E","H","J","J","F","J","E","E","I","J","J","J","I","E","H","J","J","G","I","J","D","F","F","F","E","E","D","F","E","H","D","I","I","J","D","D","H","F","H","H","E","H","F","G","I","E","D","I","J","I","I","I","I","D","D","D","I","G","I","G","G","E","D","H","H","H","H","F","E","D","D","E","E","D","E","I","E","G","H","H","H","I","E","E","G","E","G","E","F","F","E","H"],["SI2","SI1","VS1","VS2","SI2","VVS2","VVS1","SI1","VS2","VS1","SI1","VS1","SI1","SI2","SI2","I1","SI2","SI1","SI1","SI1","SI2","VS2","VS1","SI1","SI1","VVS2","VS1","VS2","VS2","VS1","VS1","VS1","VS1","VS1","VS1","VS1","VS1","SI1","VS2","SI2","SI2","SI1","VS2","VS1","SI2","SI1","SI2","SI2","VS2","SI2","SI1","VS1","SI1","VS2","VS2","SI2","SI2","SI1","SI1","SI1","VS1","SI1","SI1","SI1","SI2","VVS2","VVS1","SI1","SI1","VVS1","VVS1","SI1","SI1","SI1","SI1","VVS2","VVS2","VVS2","VVS2","VVS1","VVS1","VVS1","VVS2","SI2","VVS1","VVS1","VVS1","VVS1","VVS2","SI1","SI1","SI2","VS2","VS2","SI2","VS2","VS1","SI2","SI1","SI1"],[61.5,59.8,56.9,62.4,63.3,62.8,62.3,61.9,65.1,59.4,64,62.8,60.4,62.2,60.2,60.9,62,63.4,63.8,62.7,63.3,63.8,61,59.4,58.1,60.4,62.5,62.2,60.5,60.9,60,59.8,60.7,59.5,61.9,58.2,64.1,64,60.8,61.8,61.2,61.1,65.2,58.4,63.1,62.4,61.8,63.8,63.3,60.7,60.9,61.9,60.9,61.6,59.3,61,59.3,62.6,63,63.2,60.9,62.6,62.5,62.1,61.5,61.4,62,63.3,61.8,60.7,61.5,63.1,62.9,62.5,63.7,59.2,59.9,62.4,62.8,62.6,63.4,62.1,62.9,61.6,57.9,62.3,61.2,60.8,60.7,62.9,62.5,55.1,61.6,62.4,63.8,57.5,59.4,66.3,61.6,61.5],[55,61,65,58,58,57,57,55,61,61,55,56,61,54,62,58,54,54,56,59,56,55,57,62,62,58,57,57,61,57,57,57,59,58,58,59,59,54,59,55,56,56,56,63,56,58,55,56,60,60,61,54,55,58,62,59,61,57,57,55,57,59,57,56,59,56,55.3,57,58,58,60,56,59,57,57,60,58,54,60,59,59,60,58,56,60,59,58,59,58,58,57,69,56,57,56,58,62,62,59,58],[326,326,327,334,335,336,336,337,337,338,339,340,342,344,345,345,348,351,351,351,351,352,353,353,353,354,355,357,357,357,402,402,402,402,402,402,402,402,403,403,403,403,403,403,403,403,403,403,404,404,404,404,404,404,404,405,405,405,405,405,552,552,552,552,552,553,553,553,553,553,553,554,554,554,554,554,554,554,554,554,554,554,554,554,554,554,554,554,554,554,2757,2757,2757,2759,2759,2759,2759,2759,2760,2760],[3.95,3.89,4.05,4.2,4.34,3.94,3.95,4.07,3.87,4,4.25,3.93,3.88,4.35,3.79,4.38,4.31,4.23,4.23,4.21,4.26,3.85,3.94,4.39,4.44,3.97,3.97,4.28,3.96,3.96,4,4.04,3.97,4.01,3.92,4.06,3.83,4.29,4.13,4.49,4.49,4.49,3.99,4.19,4.34,4.24,4.35,4.36,4,4.33,4.02,3.93,4.45,3.93,3.91,4.3,4.43,4.25,4.28,4.25,4.54,4.23,4.29,4.3,4.78,4.19,4.39,4.33,4.35,4.01,3.97,4.29,4.28,4.29,4.28,4.19,4.15,4.08,4.01,4.06,4,4.03,4.02,4.65,4.22,3.95,4.01,4.02,4.07,4.35,5.7,6.45,5.7,5.68,5.81,5.85,5.71,6.27,5.77,5.97],[3.98,3.84,4.07,4.23,4.35,3.96,3.98,4.11,3.78,4.05,4.28,3.9,3.84,4.37,3.75,4.42,4.34,4.29,4.26,4.27,4.3,3.92,3.96,4.43,4.47,4.01,3.94,4.3,3.97,3.99,4.03,4.06,4.01,4.06,3.96,4.08,3.85,4.31,4.16,4.51,4.5,4.55,4.02,4.24,4.37,4.26,4.42,4.38,4.03,4.37,4.03,3.95,4.48,3.89,3.88,4.33,4.38,4.28,4.32,4.29,4.59,4.27,4.32,4.33,4.84,4.22,4.42,4.3,4.32,4.03,4,4.27,4.24,4.25,4.26,4.22,4.23,4.13,4.05,4.09,4.04,4.12,4.06,4.67,4.25,3.92,3.96,4,4.04,4.33,5.72,6.33,5.67,5.73,5.85,5.9,5.76,5.95,5.78,5.93],[2.43,2.31,2.31,2.63,2.75,2.48,2.47,2.53,2.49,2.39,2.73,2.46,2.33,2.71,2.27,2.68,2.68,2.7,2.71,2.66,2.71,2.48,2.41,2.62,2.59,2.41,2.47,2.67,2.4,2.42,2.41,2.42,2.42,2.4,2.44,2.37,2.46,2.75,2.52,2.78,2.75,2.76,2.61,2.46,2.75,2.65,2.71,2.79,2.54,2.64,2.45,2.44,2.72,2.41,2.31,2.63,2.61,2.67,2.71,2.7,2.78,2.66,2.69,2.68,2.96,2.58,2.73,2.73,2.68,2.44,2.45,2.7,2.68,2.67,2.72,2.49,2.51,2.56,2.53,2.55,2.55,2.53,2.54,2.87,2.45,2.45,2.44,2.44,2.46,2.73,3.57,3.52,3.5,3.56,3.72,3.38,3.4,4.07,3.56,3.66]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>carat<\/th>\n      <th>cut<\/th>\n      <th>color<\/th>\n      <th>clarity<\/th>\n      <th>depth<\/th>\n      <th>table<\/th>\n      <th>price<\/th>\n      <th>x<\/th>\n      <th>y<\/th>\n      <th>z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>欠損値は存在しない。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="07_cross_tally.html#cb95-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">vis_miss</span>()</span></code></pre></div>
<p><img src="My_Trivial_files/figure-html/unnamed-chunk-285-1.png" width="672" /></p>
</div>
<div id="cutカラムの度数表" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> cutカラムの度数表</h2>
<p>通常のやり方では、（１）table関数を使用して次のようにしたり、</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="07_cross_tally.html#cb96-1"></a><span class="kw">table</span>(data<span class="op">$</span>cut)</span></code></pre></div>
<pre><code>
     Fair      Good Very Good   Premium     Ideal 
     1610      4906     12082     13791     21551 </code></pre>
<p>（２）count関数を使ったり</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="07_cross_tally.html#cb98-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(cut)</span></code></pre></div>
<pre><code># A tibble: 5 x 2
  cut           n
  &lt;ord&gt;     &lt;int&gt;
1 Fair       1610
2 Good       4906
3 Very Good 12082
4 Premium   13791
5 Ideal     21551</code></pre>
<p>（３）dplyrを使う方法などがある。</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="07_cross_tally.html#cb100-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-2"><a href="07_cross_tally.html#cb100-2"></a><span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-3"><a href="07_cross_tally.html#cb100-3"></a><span class="st">  </span><span class="kw">tally</span>()</span></code></pre></div>
<pre><code># A tibble: 5 x 2
  cut           n
  &lt;ord&gt;     &lt;int&gt;
1 Fair       1610
2 Good       4906
3 Very Good 12082
4 Premium   13791
5 Ideal     21551</code></pre>
<p>janitorパッケージの関数を使うと、次のように書くことができる。</p>
<p>table関数の進化系という感じで、<strong>tabyl</strong>という関数を使う。</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="07_cross_tally.html#cb102-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tabyl</span>(cut)</span></code></pre></div>
<pre><code>       cut     n    percent
      Fair  1610 0.02984798
      Good  4906 0.09095291
 Very Good 12082 0.22398962
   Premium 13791 0.25567297
     Ideal 21551 0.39953652</code></pre>
<p>見てわかると思うが、度数の横に割合も表示してくれるのが既に便利である。</p>
<p>なおtabylの出力結果のclassはtabyl(data.frame)となっているので、tibbleにして扱いやすくしておく。</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="07_cross_tally.html#cb104-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tabyl</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span>class</span></code></pre></div>
<pre><code>[1] &quot;tabyl&quot;      &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="07_cross_tally.html#cb106-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tabyl</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span>as_tibble</span></code></pre></div>
<pre><code># A tibble: 5 x 3
  cut           n percent
  &lt;ord&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 Fair       1610  0.0298
2 Good       4906  0.0910
3 Very Good 12082  0.224 
4 Premium   13791  0.256 
5 Ideal     21551  0.400 </code></pre>
<p>dplyrで割合の計算もしようとすると、コードが少し長くなる。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="07_cross_tally.html#cb108-1"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">percent =</span> n<span class="op">/</span><span class="kw">sum</span>(n))</span></code></pre></div>
<pre><code># A tibble: 5 x 3
  cut           n percent
  &lt;ord&gt;     &lt;int&gt;   &lt;dbl&gt;
1 Fair       1610  0.0298
2 Good       4906  0.0910
3 Very Good 12082  0.224 
4 Premium   13791  0.256 
5 Ideal     21551  0.400 </code></pre>
</div>
<div id="欠損がある場合" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> 欠損がある場合</h2>
<p>最初に確認したが、もとのdiamondsデータには欠損が含まれていないので、人工的に欠損値を仕込む。</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="07_cross_tally.html#cb110-1"></a>N &lt;-<span class="st"> </span><span class="kw">nrow</span>(data)</span>
<span id="cb110-2"><a href="07_cross_tally.html#cb110-2"></a><span class="kw">set.seed</span>(<span class="dv">334</span>)</span>
<span id="cb110-3"><a href="07_cross_tally.html#cb110-3"></a>n &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>N, <span class="dv">10000</span>)</span>
<span id="cb110-4"><a href="07_cross_tally.html#cb110-4"></a></span>
<span id="cb110-5"><a href="07_cross_tally.html#cb110-5"></a>data_include_na &lt;-</span>
<span id="cb110-6"><a href="07_cross_tally.html#cb110-6"></a><span class="st">  </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-7"><a href="07_cross_tally.html#cb110-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">index =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-8"><a href="07_cross_tally.html#cb110-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cut =</span> <span class="kw">if_else</span>(index <span class="op">%in%</span><span class="st"> </span>n, <span class="kw">as.character</span>(<span class="ot">NA</span>), <span class="kw">as.character</span>(cut))) </span>
<span id="cb110-9"><a href="07_cross_tally.html#cb110-9"></a></span>
<span id="cb110-10"><a href="07_cross_tally.html#cb110-10"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">vis_miss</span>()</span></code></pre></div>
<p><img src="My_Trivial_files/figure-html/unnamed-chunk-293-1.png" width="672" /></p>
<p>集計値にNAがある場合、valid_percent（欠損を除いた割合）カラムが自動的に追加される。</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="07_cross_tally.html#cb111-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tabyl</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<pre><code># A tibble: 6 x 4
  cut           n percent valid_percent
  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
1 Fair       1295  0.0240        0.0295
2 Good       3957  0.0734        0.0901
3 Ideal     17594  0.326         0.400 
4 Premium   11317  0.210         0.258 
5 Very Good  9777  0.181         0.223 
6 &lt;NA&gt;      10000  0.185        NA     </code></pre>
</div>
<div id="度数表のtotal値" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> 度数表のtotal値</h2>
<p>度数表にtotal値を追加するにはadorn_totalsという関数を使用する。</p>
<p>adornは「装飾する」という意味らしい。</p>
<p>最後の行にTotal値が入る。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="07_cross_tally.html#cb113-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-2"><a href="07_cross_tally.html#cb113-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-3"><a href="07_cross_tally.html#cb113-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-4"><a href="07_cross_tally.html#cb113-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 7 x 4
  cut           n percent valid_percent
  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
1 Fair       1295  0.0240        0.0295
2 Good       3957  0.0734        0.0901
3 Ideal     17594  0.326         0.400 
4 Premium   11317  0.210         0.258 
5 Very Good  9777  0.181         0.223 
6 &lt;NA&gt;      10000  0.185        NA     
7 Total     53940  1             1     </code></pre>
</div>
<div id="度数表の表記" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> 度数表の％表記</h2>
<p>度数表を作成したあとにそのデータで分析を進めないのであれば、割合を％表記にすると少し表が見やすくなる。</p>
<p>adorn_pct_formatting関数を使う。</p>
<p>digits で桁数を指定する。</p>
<p>affix_singをFALSEにすれば％表記を消すこともできる。</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="07_cross_tally.html#cb115-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-2"><a href="07_cross_tally.html#cb115-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-3"><a href="07_cross_tally.html#cb115-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-4"><a href="07_cross_tally.html#cb115-4"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">affix_sign =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-5"><a href="07_cross_tally.html#cb115-5"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 7 x 4
  cut           n percent valid_percent
  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;        
1 Fair       1295 2.40%   2.95%        
2 Good       3957 7.34%   9.01%        
3 Ideal     17594 32.62%  40.04%       
4 Premium   11317 20.98%  25.76%       
5 Very Good  9777 18.13%  22.25%       
6 &lt;NA&gt;      10000 18.54%  -            
7 Total     53940 100.00% 100.00%      </code></pre>
</div>
<div id="クロス集計" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> クロス集計</h2>
<p>いよいよクロス集計をしてみる。</p>
<div id="通常のやり方" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> 通常のやり方</h3>
<p>通常のやり方では、table関数を使用して次のようにする。</p>
<p><strong>度数表</strong></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="07_cross_tally.html#cb117-1"></a><span class="kw">table</span>(data_include_na<span class="op">$</span>cut,</span>
<span id="cb117-2"><a href="07_cross_tally.html#cb117-2"></a>      data_include_na<span class="op">$</span>color) </span></code></pre></div>
<pre><code>           
               D    E    F    G    H    I    J
  Fair       136  179  243  248  248  142   99
  Good       555  756  715  689  572  425  245
  Ideal     2284 3219 3124 4000 2518 1711  738
  Premium   1302 1919 1920 2386 1933 1181  676
  Very Good 1252 1936 1755 1857 1480  968  529</code></pre>
<p><strong>割合</strong></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="07_cross_tally.html#cb119-1"></a><span class="kw">prop.table</span>(<span class="kw">table</span>(data_include_na<span class="op">$</span>cut, </span>
<span id="cb119-2"><a href="07_cross_tally.html#cb119-2"></a>                 data_include_na<span class="op">$</span>color))</span></code></pre></div>
<pre><code>           
                      D           E           F           G           H           I           J
  Fair      0.003095130 0.004073737 0.005530269 0.005644060 0.005644060 0.003231680 0.002253072
  Good      0.012630860 0.017205280 0.016272189 0.015680473 0.013017751 0.009672280 0.005575785
  Ideal     0.051979973 0.073258990 0.071096950 0.091033227 0.057305416 0.038939463 0.016795630
  Premium   0.029631315 0.043673191 0.043695949 0.054301320 0.043991807 0.026877560 0.015384615
  Very Good 0.028493400 0.044060082 0.039940828 0.042262176 0.033682294 0.022030041 0.012039144</code></pre>
</div>
<div id="janitorのやり方" class="section level3" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> janitorのやり方</h3>
<p>janitorパッケージのtabyl関数を使うと次のように書ける。</p>
<p><strong>度数表</strong></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="07_cross_tally.html#cb121-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb121-2"><a href="07_cross_tally.html#cb121-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb121-3"><a href="07_cross_tally.html#cb121-3"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 6 x 8
  cut           D     E     F     G     H     I     J
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Fair        136   179   243   248   248   142    99
2 Good        555   756   715   689   572   425   245
3 Ideal      2284  3219  3124  4000  2518  1711   738
4 Premium    1302  1919  1920  2386  1933  1181   676
5 Very Good  1252  1936  1755  1857  1480   968   529
6 &lt;NA&gt;       1246  1788  1785  2112  1553   995   521</code></pre>
<p><strong>割合</strong></p>
<p>adorn_percentages関数を使用する。</p>
<p>denominatorは “all”, “col”, “row”の中から選ぶことができる。</p>
<p>同時確率を見たいか、行か列での条件つき確率をみたいかどうかで変える。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="07_cross_tally.html#cb123-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-2"><a href="07_cross_tally.html#cb123-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-3"><a href="07_cross_tally.html#cb123-3"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;all&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-4"><a href="07_cross_tally.html#cb123-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 6 x 8
  cut             D       E       F       G       H       I       J
  &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Fair      0.00252 0.00332 0.00451 0.00460 0.00460 0.00263 0.00184
2 Good      0.0103  0.0140  0.0133  0.0128  0.0106  0.00788 0.00454
3 Ideal     0.0423  0.0597  0.0579  0.0742  0.0467  0.0317  0.0137 
4 Premium   0.0241  0.0356  0.0356  0.0442  0.0358  0.0219  0.0125 
5 Very Good 0.0232  0.0359  0.0325  0.0344  0.0274  0.0179  0.00981
6 &lt;NA&gt;      0.0231  0.0331  0.0331  0.0392  0.0288  0.0184  0.00966</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="07_cross_tally.html#cb125-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-2"><a href="07_cross_tally.html#cb125-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-3"><a href="07_cross_tally.html#cb125-3"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-4"><a href="07_cross_tally.html#cb125-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 6 x 8
  cut            D      E      F      G      H      I      J
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Fair      0.0201 0.0183 0.0255 0.0220 0.0299 0.0262 0.0353
2 Good      0.0819 0.0772 0.0749 0.0610 0.0689 0.0784 0.0873
3 Ideal     0.337  0.329  0.327  0.354  0.303  0.316  0.263 
4 Premium   0.192  0.196  0.201  0.211  0.233  0.218  0.241 
5 Very Good 0.185  0.198  0.184  0.164  0.178  0.179  0.188 
6 &lt;NA&gt;      0.184  0.183  0.187  0.187  0.187  0.184  0.186 </code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="07_cross_tally.html#cb127-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-2"><a href="07_cross_tally.html#cb127-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-3"><a href="07_cross_tally.html#cb127-3"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;row&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-4"><a href="07_cross_tally.html#cb127-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 6 x 8
  cut           D     E     F     G     H      I      J
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Fair      0.105 0.138 0.188 0.192 0.192 0.110  0.0764
2 Good      0.140 0.191 0.181 0.174 0.145 0.107  0.0619
3 Ideal     0.130 0.183 0.178 0.227 0.143 0.0972 0.0419
4 Premium   0.115 0.170 0.170 0.211 0.171 0.104  0.0597
5 Very Good 0.128 0.198 0.180 0.190 0.151 0.0990 0.0541
6 &lt;NA&gt;      0.125 0.179 0.178 0.211 0.155 0.0995 0.0521</code></pre>
</div>
</div>
<div id="クロス集計の装飾" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> クロス集計の装飾</h2>
<div id="totalと" class="section level3" number="7.8.1">
<h3><span class="header-section-number">7.8.1</span> totalと％</h3>
<p>度数表と同様にして、Total値を付けたり、％表記をすることができる。</p>
<p><strong>カラムごとに合計</strong></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="07_cross_tally.html#cb129-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="07_cross_tally.html#cb129-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-3"><a href="07_cross_tally.html#cb129-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;row&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-4"><a href="07_cross_tally.html#cb129-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-5"><a href="07_cross_tally.html#cb129-5"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">affix_sign =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-6"><a href="07_cross_tally.html#cb129-6"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 7 x 8
  cut       D       E       F       G       H       I       J      
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 Fair      2.01%   1.83%   2.55%   2.20%   2.99%   2.62%   3.53%  
2 Good      8.19%   7.72%   7.49%   6.10%   6.89%   7.84%   8.73%  
3 Ideal     33.71%  32.86%  32.74%  35.42%  30.32%  31.56%  26.28% 
4 Premium   19.22%  19.59%  20.12%  21.13%  23.28%  21.78%  24.07% 
5 Very Good 18.48%  19.76%  18.39%  16.45%  17.82%  17.85%  18.84% 
6 &lt;NA&gt;      18.39%  18.25%  18.71%  18.70%  18.70%  18.35%  18.55% 
7 Total     100.00% 100.00% 100.00% 100.00% 100.00% 100.00% 100.00%</code></pre>
<p><strong>行ごとに合計</strong></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="07_cross_tally.html#cb131-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-2"><a href="07_cross_tally.html#cb131-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-3"><a href="07_cross_tally.html#cb131-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-4"><a href="07_cross_tally.html#cb131-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;row&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-5"><a href="07_cross_tally.html#cb131-5"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">affix_sign =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-6"><a href="07_cross_tally.html#cb131-6"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 6 x 9
  cut       D      E      F      G      H      I      J     Total  
  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
1 Fair      10.50% 13.82% 18.76% 19.15% 19.15% 10.97% 7.64% 100.00%
2 Good      14.03% 19.11% 18.07% 17.41% 14.46% 10.74% 6.19% 100.00%
3 Ideal     12.98% 18.30% 17.76% 22.74% 14.31% 9.72%  4.19% 100.00%
4 Premium   11.50% 16.96% 16.97% 21.08% 17.08% 10.44% 5.97% 100.00%
5 Very Good 12.81% 19.80% 17.95% 18.99% 15.14% 9.90%  5.41% 100.00%
6 &lt;NA&gt;      12.46% 17.88% 17.85% 21.12% 15.53% 9.95%  5.21% 100.00%</code></pre>
<p><strong>全体で合計</strong></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="07_cross_tally.html#cb133-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="07_cross_tally.html#cb133-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-3"><a href="07_cross_tally.html#cb133-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;col&quot;</span>, <span class="st">&quot;row&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-4"><a href="07_cross_tally.html#cb133-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;all&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-5"><a href="07_cross_tally.html#cb133-5"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">affix_sign =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-6"><a href="07_cross_tally.html#cb133-6"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 7 x 9
  cut       D      E      F      G      H      I      J     Total  
  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  
1 Fair      0.25%  0.33%  0.45%  0.46%  0.46%  0.26%  0.18% 2.40%  
2 Good      1.03%  1.40%  1.33%  1.28%  1.06%  0.79%  0.45% 7.34%  
3 Ideal     4.23%  5.97%  5.79%  7.42%  4.67%  3.17%  1.37% 32.62% 
4 Premium   2.41%  3.56%  3.56%  4.42%  3.58%  2.19%  1.25% 20.98% 
5 Very Good 2.32%  3.59%  3.25%  3.44%  2.74%  1.79%  0.98% 18.13% 
6 &lt;NA&gt;      2.31%  3.31%  3.31%  3.92%  2.88%  1.84%  0.97% 18.54% 
7 Total     12.56% 18.16% 17.69% 20.93% 15.39% 10.05% 5.21% 100.00%</code></pre>
</div>
<div id="集計値の名前を変更" class="section level3" number="7.8.2">
<h3><span class="header-section-number">7.8.2</span> 集計値の名前を変更</h3>
<p>adorn_titleという関数を使うと、何と何で集計を行っているかを一番左上のセルに追加できる。</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="07_cross_tally.html#cb135-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-2"><a href="07_cross_tally.html#cb135-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-3"><a href="07_cross_tally.html#cb135-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-4"><a href="07_cross_tally.html#cb135-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-5"><a href="07_cross_tally.html#cb135-5"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-6"><a href="07_cross_tally.html#cb135-6"></a><span class="st">  </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">col_name =</span> <span class="st">&quot;color&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-7"><a href="07_cross_tally.html#cb135-7"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span></code></pre></div>
<pre><code># A tibble: 7 x 9
  `cut/color` D       E       F       G       H       I       J       Total  
  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 Fair        2.01%   1.83%   2.55%   2.20%   2.99%   2.62%   3.53%   2.40%  
2 Good        8.19%   7.72%   7.49%   6.10%   6.89%   7.84%   8.73%   7.34%  
3 Ideal       33.71%  32.86%  32.74%  35.42%  30.32%  31.56%  26.28%  32.62% 
4 Premium     19.22%  19.59%  20.12%  21.13%  23.28%  21.78%  24.07%  20.98% 
5 Very Good   18.48%  19.76%  18.39%  16.45%  17.82%  17.85%  18.84%  18.13% 
6 &lt;NA&gt;        18.39%  18.25%  18.71%  18.70%  18.70%  18.35%  18.55%  18.54% 
7 Total       100.00% 100.00% 100.00% 100.00% 100.00% 100.00% 100.00% 100.00%</code></pre>
</div>
<div id="度数表と割合を同時に表示" class="section level3" number="7.8.3">
<h3><span class="header-section-number">7.8.3</span> 度数表と割合を同時に表示</h3>
<p>adorn_nsという関数を使うと、度数と割合を同時に表示できる。</p>
<p>引数positionに</p>
<ul>
<li>“front”を指定すると割合が（）内に表示される</li>
<li>“rear”を指定すると度数が（）内に表示される</li>
</ul>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="07_cross_tally.html#cb137-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-2"><a href="07_cross_tally.html#cb137-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-3"><a href="07_cross_tally.html#cb137-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-4"><a href="07_cross_tally.html#cb137-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-5"><a href="07_cross_tally.html#cb137-5"></a><span class="st">  </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-6"><a href="07_cross_tally.html#cb137-6"></a><span class="st">  </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">col_name =</span> <span class="st">&quot;color&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-7"><a href="07_cross_tally.html#cb137-7"></a><span class="st">  </span><span class="kw">adorn_ns</span>(<span class="dt">position =</span> <span class="st">&quot;front&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-8"><a href="07_cross_tally.html#cb137-8"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-570ddb78db96bec2ebf4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-570ddb78db96bec2ebf4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["Fair","Good","Ideal","Premium","Very Good",null,"Total"],[" 136   (2.01%)"," 555   (8.19%)","2284  (33.71%)","1302  (19.22%)","1252  (18.48%)","1246  (18.39%)","6775 (100.00%)"],[" 179   (1.83%)"," 756   (7.72%)","3219  (32.86%)","1919  (19.59%)","1936  (19.76%)","1788  (18.25%)","9797 (100.00%)"],[" 243   (2.55%)"," 715   (7.49%)","3124  (32.74%)","1920  (20.12%)","1755  (18.39%)","1785  (18.71%)","9542 (100.00%)"],["  248   (2.20%)","  689   (6.10%)"," 4000  (35.42%)"," 2386  (21.13%)"," 1857  (16.45%)"," 2112  (18.70%)","11292 (100.00%)"],[" 248   (2.99%)"," 572   (6.89%)","2518  (30.32%)","1933  (23.28%)","1480  (17.82%)","1553  (18.70%)","8304 (100.00%)"],[" 142   (2.62%)"," 425   (7.84%)","1711  (31.56%)","1181  (21.78%)"," 968  (17.85%)"," 995  (18.35%)","5422 (100.00%)"],["  99   (3.53%)"," 245   (8.73%)"," 738  (26.28%)"," 676  (24.07%)"," 529  (18.84%)"," 521  (18.55%)","2808 (100.00%)"],[" 1295   (2.40%)"," 3957   (7.34%)","17594  (32.62%)","11317  (20.98%)"," 9777  (18.13%)","10000  (18.54%)","53940 (100.00%)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cut/color<\/th>\n      <th>D<\/th>\n      <th>E<\/th>\n      <th>F<\/th>\n      <th>G<\/th>\n      <th>H<\/th>\n      <th>I<\/th>\n      <th>J<\/th>\n      <th>Total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="関数化" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> 関数化</h2>
<p>2つの変数を入れるとクロス集計表が出てくるように関数化しておくと便利だろう。</p>
<p>（2重 curly brackets{{}}やenquoなどの黒魔術はスルーしてほしい）</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="07_cross_tally.html#cb138-1"></a>cross_tally &lt;-<span class="st"> </span><span class="cf">function</span>(data, var1, var2, <span class="dt">affix_sign_TF =</span> <span class="ot">TRUE</span>, <span class="dt">adorn_ns_TF =</span> <span class="ot">TRUE</span>){</span>
<span id="cb138-2"><a href="07_cross_tally.html#cb138-2"></a>  res &lt;-</span>
<span id="cb138-3"><a href="07_cross_tally.html#cb138-3"></a><span class="st">    </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-4"><a href="07_cross_tally.html#cb138-4"></a><span class="st">    </span><span class="kw">tabyl</span>({{var1}}, {{var2}}) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-5"><a href="07_cross_tally.html#cb138-5"></a><span class="st">    </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb138-6"><a href="07_cross_tally.html#cb138-6"></a><span class="st">    </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb138-7"><a href="07_cross_tally.html#cb138-7"></a><span class="st">    </span><span class="kw">adorn_pct_formatting</span>(<span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">affix_sign =</span> affix_sign_TF) <span class="op">%&gt;%</span></span>
<span id="cb138-8"><a href="07_cross_tally.html#cb138-8"></a><span class="st">    </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>,</span>
<span id="cb138-9"><a href="07_cross_tally.html#cb138-9"></a>                <span class="dt">row_name =</span> <span class="kw">as_label</span>(<span class="kw">enquo</span>(var1)),</span>
<span id="cb138-10"><a href="07_cross_tally.html#cb138-10"></a>                <span class="dt">col_name =</span> <span class="kw">as_label</span>(<span class="kw">enquo</span>(var2))) </span>
<span id="cb138-11"><a href="07_cross_tally.html#cb138-11"></a></span>
<span id="cb138-12"><a href="07_cross_tally.html#cb138-12"></a>  <span class="cf">if</span> (adorn_ns_TF){</span>
<span id="cb138-13"><a href="07_cross_tally.html#cb138-13"></a>    res &lt;-<span class="st"> </span></span>
<span id="cb138-14"><a href="07_cross_tally.html#cb138-14"></a><span class="st">      </span>res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">adorn_ns</span>(<span class="dt">position =</span> <span class="st">&quot;front&quot;</span>)</span>
<span id="cb138-15"><a href="07_cross_tally.html#cb138-15"></a>    }</span>
<span id="cb138-16"><a href="07_cross_tally.html#cb138-16"></a>  </span>
<span id="cb138-17"><a href="07_cross_tally.html#cb138-17"></a>  <span class="kw">return</span>(<span class="kw">as_tibble</span>(res))</span>
<span id="cb138-18"><a href="07_cross_tally.html#cb138-18"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="07_cross_tally.html#cb139-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cross_tally</span>(cut, color)</span></code></pre></div>
<pre><code># A tibble: 7 x 9
  `cut/color` D                E                F                G                 H                I                J                Total            
  &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            
1 Fair        &quot; 136   (2.01%)&quot; &quot; 179   (1.83%)&quot; &quot; 243   (2.55%)&quot; &quot;  248   (2.20%)&quot; &quot; 248   (2.99%)&quot; &quot; 142   (2.62%)&quot; &quot;  99   (3.53%)&quot; &quot; 1295   (2.40%)&quot;
2 Good        &quot; 555   (8.19%)&quot; &quot; 756   (7.72%)&quot; &quot; 715   (7.49%)&quot; &quot;  689   (6.10%)&quot; &quot; 572   (6.89%)&quot; &quot; 425   (7.84%)&quot; &quot; 245   (8.73%)&quot; &quot; 3957   (7.34%)&quot;
3 Ideal       &quot;2284  (33.71%)&quot; &quot;3219  (32.86%)&quot; &quot;3124  (32.74%)&quot; &quot; 4000  (35.42%)&quot; &quot;2518  (30.32%)&quot; &quot;1711  (31.56%)&quot; &quot; 738  (26.28%)&quot; &quot;17594  (32.62%)&quot;
4 Premium     &quot;1302  (19.22%)&quot; &quot;1919  (19.59%)&quot; &quot;1920  (20.12%)&quot; &quot; 2386  (21.13%)&quot; &quot;1933  (23.28%)&quot; &quot;1181  (21.78%)&quot; &quot; 676  (24.07%)&quot; &quot;11317  (20.98%)&quot;
5 Very Good   &quot;1252  (18.48%)&quot; &quot;1936  (19.76%)&quot; &quot;1755  (18.39%)&quot; &quot; 1857  (16.45%)&quot; &quot;1480  (17.82%)&quot; &quot; 968  (17.85%)&quot; &quot; 529  (18.84%)&quot; &quot; 9777  (18.13%)&quot;
6 &lt;NA&gt;        &quot;1246  (18.39%)&quot; &quot;1788  (18.25%)&quot; &quot;1785  (18.71%)&quot; &quot; 2112  (18.70%)&quot; &quot;1553  (18.70%)&quot; &quot; 995  (18.35%)&quot; &quot; 521  (18.55%)&quot; &quot;10000  (18.54%)&quot;
7 Total       &quot;6775 (100.00%)&quot; &quot;9797 (100.00%)&quot; &quot;9542 (100.00%)&quot; &quot;11292 (100.00%)&quot; &quot;8304 (100.00%)&quot; &quot;5422 (100.00%)&quot; &quot;2808 (100.00%)&quot; &quot;53940 (100.00%)&quot;</code></pre>
</div>
<div id="可視化-1" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> 可視化</h2>
<div id="モザイクプロット" class="section level3" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> モザイクプロット</h3>
<p>クロス集計表はモザイクプロットを使用して可視化することが多いが、結構見づらいことが多い。</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="07_cross_tally.html#cb141-1"></a>df &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-2"><a href="07_cross_tally.html#cb141-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-3"><a href="07_cross_tally.html#cb141-3"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;all&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-4"><a href="07_cross_tally.html#cb141-4"></a><span class="st">  </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">col_name =</span> <span class="st">&quot;color&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-5"><a href="07_cross_tally.html#cb141-5"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span>
<span id="cb141-6"><a href="07_cross_tally.html#cb141-6"></a></span>
<span id="cb141-7"><a href="07_cross_tally.html#cb141-7"></a>mat &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">cut/color</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>() </span>
<span id="cb141-8"><a href="07_cross_tally.html#cb141-8"></a><span class="kw">colnames</span>(mat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">cut/color</span><span class="st">`</span>))</span>
<span id="cb141-9"><a href="07_cross_tally.html#cb141-9"></a><span class="kw">rownames</span>(mat) &lt;-<span class="st"> </span>df<span class="op">$</span><span class="st">`</span><span class="dt">cut/color</span><span class="st">`</span></span>
<span id="cb141-10"><a href="07_cross_tally.html#cb141-10"></a></span>
<span id="cb141-11"><a href="07_cross_tally.html#cb141-11"></a><span class="kw">t</span>(mat) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mosaicplot</span>(<span class="st">&quot;クロス集計&quot;</span>)</span></code></pre></div>
<p><img src="My_Trivial_files/figure-html/unnamed-chunk-309-1.png" width="672" /></p>
<p>DTパッケージを使用して、テーブルのまま装飾を加えることできれいに可視化することができる。</p>
</div>
<div id="通常のテーブル" class="section level3" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> 通常のテーブル</h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="07_cross_tally.html#cb142-1"></a>data_include_na <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-2"><a href="07_cross_tally.html#cb142-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-3"><a href="07_cross_tally.html#cb142-3"></a><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="dt">where =</span> <span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-4"><a href="07_cross_tally.html#cb142-4"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;all&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-5"><a href="07_cross_tally.html#cb142-5"></a><span class="st">  </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">col_name =</span> <span class="st">&quot;color&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-6"><a href="07_cross_tally.html#cb142-6"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb142-7"><a href="07_cross_tally.html#cb142-7"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-8"><a href="07_cross_tally.html#cb142-8"></a><span class="st">  </span>DT<span class="op">::</span><span class="kw">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-a026060a943873f5ba62" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a026060a943873f5ba62">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7"],["Fair","Good","Ideal","Premium","Very Good",null,"Total"],[0.00252,0.01029,0.04234,0.02414,0.02321,0.0231,0.1256],[0.00332,0.01402,0.05968,0.03558,0.03589,0.03315,0.18163],[0.00451,0.01326,0.05792,0.0356,0.03254,0.03309,0.1769],[0.0046,0.01277,0.07416,0.04423,0.03443,0.03915,0.20934],[0.0046,0.0106,0.04668,0.03584,0.02744,0.02879,0.15395],[0.00263,0.00788,0.03172,0.02189,0.01795,0.01845,0.10052],[0.00184,0.00454,0.01368,0.01253,0.00981,0.00966,0.05206],[0.02401,0.07336,0.32618,0.20981,0.18126,0.18539,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cut/color<\/th>\n      <th>D<\/th>\n      <th>E<\/th>\n      <th>F<\/th>\n      <th>G<\/th>\n      <th>H<\/th>\n      <th>I<\/th>\n      <th>J<\/th>\n      <th>Total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="装飾を加えたテーブル" class="section level3" number="7.10.3">
<h3><span class="header-section-number">7.10.3</span> 装飾を加えたテーブル</h3>
<ul>
<li>参考
<ul>
<li><a href="https://kazutan.github.io/SappoRoR5/DT_demo.html" class="uri">https://kazutan.github.io/SappoRoR5/DT_demo.html</a></li>
<li><a href="https://rstudio.github.io/DT/010-style.html" class="uri">https://rstudio.github.io/DT/010-style.html</a></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="07_cross_tally.html#cb143-1"></a>df &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-2"><a href="07_cross_tally.html#cb143-2"></a><span class="st">  </span><span class="kw">tabyl</span>(cut, color) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-3"><a href="07_cross_tally.html#cb143-3"></a><span class="st">  </span><span class="kw">adorn_percentages</span>(<span class="dt">denominator =</span> <span class="st">&quot;all&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-4"><a href="07_cross_tally.html#cb143-4"></a><span class="st">  </span><span class="kw">adorn_title</span>(<span class="dt">placement =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">col_name =</span> <span class="st">&quot;color&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-5"><a href="07_cross_tally.html#cb143-5"></a><span class="st">  </span><span class="kw">as_tibble</span>() </span>
<span id="cb143-6"><a href="07_cross_tally.html#cb143-6"></a></span>
<span id="cb143-7"><a href="07_cross_tally.html#cb143-7"></a>df <span class="op">%&gt;%</span></span>
<span id="cb143-8"><a href="07_cross_tally.html#cb143-8"></a><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-9"><a href="07_cross_tally.html#cb143-9"></a><span class="st">  </span>DT<span class="op">::</span><span class="kw">datatable</span>() <span class="op">%&gt;%</span></span>
<span id="cb143-10"><a href="07_cross_tally.html#cb143-10"></a><span class="st">  </span><span class="kw">formatStyle</span>(<span class="kw">names</span>(df),</span>
<span id="cb143-11"><a href="07_cross_tally.html#cb143-11"></a>  <span class="dt">background =</span> <span class="kw">styleColorBar</span>(<span class="kw">range</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">cut/color</span><span class="st">`</span>)), <span class="st">&#39;lightblue&#39;</span>),</span>
<span id="cb143-12"><a href="07_cross_tally.html#cb143-12"></a>  <span class="dt">backgroundSize =</span> <span class="st">&#39;98% 88%&#39;</span>,</span>
<span id="cb143-13"><a href="07_cross_tally.html#cb143-13"></a>  <span class="dt">backgroundRepeat =</span> <span class="st">&#39;no-repeat&#39;</span>,</span>
<span id="cb143-14"><a href="07_cross_tally.html#cb143-14"></a>  <span class="dt">backgroundPosition =</span> <span class="st">&#39;center&#39;</span>) </span></code></pre></div>
<div id="htmlwidget-0ccce431167b5a18941c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0ccce431167b5a18941c">{"x":{"filter":"none","data":[["1","2","3","4","5"],["Fair","Good","Very Good","Premium","Ideal"],[0.00302,0.01227,0.02805,0.02972,0.05254],[0.00415,0.0173,0.04449,0.04333,0.07236],[0.00578,0.01685,0.04012,0.04321,0.07093],[0.00582,0.01615,0.04262,0.05421,0.09055],[0.00562,0.01301,0.03382,0.04375,0.05775],[0.00324,0.00968,0.02232,0.02647,0.0388],[0.00221,0.00569,0.01257,0.01498,0.01661]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cut/color<\/th>\n      <th>D<\/th>\n      <th>E<\/th>\n      <th>F<\/th>\n      <th>G<\/th>\n      <th>H<\/th>\n      <th>I<\/th>\n      <th>J<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[6]; $(this.api().cell(row, 6).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[7]; $(this.api().cell(row, 7).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\nvar value=data[8]; $(this.api().cell(row, 8).node()).css({'background':isNaN(parseFloat(value)) || value <= 0.002206 ? '' : 'linear-gradient(90.000000deg, transparent ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%, lightblue ' + Math.max(0.090545 - value, 0)/0.088339 * 100 + '%)','background-size':'98% 88%','background-repeat':'no-repeat','background-position':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="06_NBA_cluster.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["My_Trivial.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
